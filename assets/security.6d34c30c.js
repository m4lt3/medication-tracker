import{p as Z,bs as ee,g as te,C as T,bt as se,bu as le,o as q,ai as ae,u as ne,bh as ie,bv as E,x as f,c as t,E as I,bw as re,bx as oe,a2 as ue,ay as de,a4 as A,ab as U,a6 as o,ar as p,aa as u,a9 as g,b9 as R,ba as L,a7 as h,av as H,aw as x,at as N,au as z,bp as ce,by as pe,bz as J}from"./index.c008f4b7.js";import{u as fe}from"./config.5ac62d0a.js";import{_ as me}from"./deleteModal.554ad063.js";import{V as ye}from"./VContainer.0e6f66d5.js";import{V as M}from"./VForm.94c3fd6c.js";import{m as ve,V as O}from"./VSelectionControl.b676dcd8.js";/* empty css              */const ge=Z({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...ee(),...ve()},"VSwitch"),Ve=te()({name:"VSwitch",inheritAttrs:!1,props:ge(),emits:{"update:focused":s=>!0,"update:modelValue":()=>!0,"update:indeterminate":s=>!0},setup(s,m){let{attrs:l,slots:i}=m;const a=T(s,"indeterminate"),d=T(s,"modelValue"),{loaderClasses:C}=se(s),{isFocused:V,focus:b,blur:y}=le(s),v=q(()=>typeof s.loading=="string"&&s.loading!==""?s.loading:s.color),c=ae(),S=q(()=>s.id||`switch-${c}`);function $(){a.value&&(a.value=!1)}return ne(()=>{const[P,e]=ie(l),[n,r]=E.filterProps(s),[W,we]=O.filterProps(s),D=f();function j(w){var _,k;w.stopPropagation(),w.preventDefault(),(k=(_=D.value)==null?void 0:_.input)==null||k.click()}return t(E,I({class:["v-switch",{"v-switch--inset":s.inset},{"v-switch--indeterminate":a.value},C.value,s.class],style:s.style},P,n,{id:S.value,focused:V.value}),{...i,default:w=>{let{id:_,messagesId:k,isDisabled:G,isReadonly:K,isValid:Q}=w;return t(O,I({ref:D},W,{modelValue:d.value,"onUpdate:modelValue":[B=>d.value=B,$],id:_.value,"aria-describedby":k.value,type:"checkbox","aria-checked":a.value?"mixed":void 0,disabled:G.value,readonly:K.value,onFocus:b,onBlur:y},e),{...i,default:()=>t("div",{class:"v-switch__track",onClick:j},null),input:B=>{let{textColorClasses:X,textColorStyles:Y}=B;return t("div",{class:["v-switch__thumb",X.value],style:Y.value},[s.loading&&t(re,{name:"v-switch",active:!0,color:Q.value===!1?void 0:v.value},{default:F=>i.loader?i.loader(F):t(oe,{active:F.isActive,color:F.color,indeterminate:!0,size:"16",width:"2"},null)})])}})}})}),{}}}),be={class:"text-h2"},Be={__name:"security",setup(s){const m=ue(),l=fe(),{t:i}=de(),a=f({}),d=f({visible:!1}),C={}.VITE_PASSWORD_TESTPHRASE,V=f(null),b=f(null),y=f(!1),v=f(!1),c={required:e=>e?!0:i("forms.required"),minLength:e=>e.length>7?!0:i("forms.min_8"),samePassword:e=>a.value.new==a.value.confirm?!0:i("forms.password_mismatch")};async function S(){if(await V.value.validate(),!!y.value){l.config.encrypted=!0,l.config.testphrase=pe.exports.AES.encrypt(C,a.value.new).toString(),l.password=a.value.new;try{await J.encryptDB(),d.value={visible:!0,type:"success",title:i("settings.security.encryption_enabled_title"),text:i("settings.security.encryption_enabled_text")}}catch(e){l.config.encrypted=!1,l.config.testPhrase=void 0,l.password=null,d.value={visible:!0,type:"error",title:i("settings.security.error"),text:e.message}}}}async function $(){if(await b.value.validate(),!!v.value){if(a.value.old!=l.password){d.value={visible:!0,type:"error",title:i("settings.security.password_incorrect_title"),text:i("settings.security.password_incorrect_text")};return}await J.decryptDB(),l.config.encrypted=!1,l.config.testphrase=void 0,l.password=null,d.value={visible:!0,type:"success",title:i("settings.security.encryption_disabled_title"),text:i("settings.security.encryption_disabled_text")}}}async function P(){await m.purge(),l.config={},l.password=null,m.init(),m.passwordRequired=!1}return(e,n)=>(A(),U(ye,null,{default:o(()=>[p("h1",be,u(e.$t("settings.security.title")),1),p("p",null,u(e.$t("settings.security.p1")),1),p("p",null,u(e.$t("settings.security.p2")),1),p("p",null,[g(u(e.$t("settings.security.p3"))+" ",1),p("b",null,u(e.$t("settings.security.p3b")),1)]),p("p",null,u(e.$t("settings.security.p4")),1),p("p",null,u(e.$t("settings.security.p5")),1),t(z,{class:"my-3"},{default:o(()=>[t(R,null,{default:o(()=>[t(L,null,{default:o(()=>[g(u(e.$t("settings.security.data_is"))+u(h(l).config.encrypted?" ":" "+e.$t("settings.security.not"))+" "+u(e.$t("settings.security.encrypted")),1)]),_:1})]),_:1}),t(H,null,{default:o(()=>[h(l).config.encrypted?(A(),U(M,{key:1,ref_key:"decryptionForm",ref:b,modelValue:v.value,"onUpdate:modelValue":n[4]||(n[4]=r=>v.value=r)},{default:o(()=>[t(x,{type:"password",label:e.$t("settings.security.current_pw"),modelValue:a.value.old,"onUpdate:modelValue":n[3]||(n[3]=r=>a.value.old=r),rules:[c.required]},null,8,["label","modelValue","rules"]),t(N,{block:"","prepend-icon":"mdi-lock-open-outline",onClick:$},{default:o(()=>[g(u(e.$t("settings.security.disable_encryption")),1)]),_:1})]),_:1},8,["modelValue"])):(A(),U(M,{key:0,ref_key:"encryptionForm",ref:V,modelValue:y.value,"onUpdate:modelValue":n[2]||(n[2]=r=>y.value=r)},{default:o(()=>[t(x,{type:"password",label:e.$t("settings.security.new_pw"),modelValue:a.value.new,"onUpdate:modelValue":n[0]||(n[0]=r=>a.value.new=r),rules:[c.required,c.minLength]},null,8,["label","modelValue","rules"]),t(x,{type:"password",label:e.$t("settings.security.confirm_pw"),modelValue:a.value.confirm,"onUpdate:modelValue":n[1]||(n[1]=r=>a.value.confirm=r),rules:[c.required,c.samePassword]},null,8,["label","modelValue","rules"]),t(N,{block:"","prepend-icon":"mdi-lock-outline",onClick:S},{default:o(()=>[g(u(e.$t("settings.security.enable_encryption")),1)]),_:1})]),_:1},8,["modelValue"]))]),_:1})]),_:1}),t(z,{class:"my-3"},{default:o(()=>[t(R,null,{default:o(()=>[t(L,null,{default:o(()=>[g(u(e.$t("settings.security.intake_history")),1)]),_:1}),t(H,null,{default:o(()=>[t(Ve,{modelValue:h(l).config.intakeHistory,"onUpdate:modelValue":n[5]||(n[5]=r=>h(l).config.intakeHistory=r),label:e.$t("settings.security.save_beyond")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),t(ce,I({class:"my-2",modelValue:d.value.visible,"onUpdate:modelValue":n[6]||(n[6]=r=>d.value.visible=r)},d.value,{closable:""}),null,16,["modelValue"]),t(me,{style:{width:"100%"},text:e.$t("settings.security.purge"),onDelete:P},null,8,["text"])]),_:1}))}};export{Be as default};
