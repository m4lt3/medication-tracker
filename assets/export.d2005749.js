import{a4 as $,ab as F,a6 as r,a9 as S,aa as v,c as a,av as Q,ar as C,at as W,au as X,ag as G,bA as D,bz as Z,p as pe,bs as fe,aY as ve,bB as me,g as be,J as ye,C as ge,bu as he,o as h,bC as H,x as y,z as Ve,u as Ce,bh as ke,bv as L,bD as we,bE as xe,E as _,ad as B,bF as Se,a1 as Ie,bj as _e,bG as $e,a2 as Fe,R as Ne,ac as Ae,bH as Pe,bp as Re,bI as K}from"./index.c008f4b7.js";import{V as U,a as N}from"./VRow.728c9e3d.js";import{V as ze}from"./VChip.563f6689.js";import{V as Be}from"./VContainer.0e6f66d5.js";/* empty css              */const De={__name:"export",setup(e){async function c(){let d={encryption:{enabled:G.read().encrypted,testphrase:G.read().testphrase},stores:{}};for(let l in D)d.stores[l]=await Z.getAllFrom(D[l],!1);let i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(d))),i.setAttribute("download","medicationTrackerData.json"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}return(d,i)=>($(),F(X,{"prepend-icon":"mdi-arrow-up-bold"},{title:r(()=>[S(v(d.$t("settings.export.export.title")),1)]),default:r(()=>[a(Q,null,{default:r(()=>[C("p",null,v(d.$t("settings.export.export.p1")),1),a(W,{block:"",color:"primary","prepend-icon":"mdi-arrow-up",onClick:c},{default:r(()=>[S(v(d.$t("settings.export.export.export_action")),1)]),_:1})]),_:1})]),_:1}))}};const Ue=pe({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,showSize:{type:[Boolean,Number],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(e)},...fe({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:e=>ve(e).every(c=>c!=null&&typeof c=="object")},...me({clearable:!0})},"VFileInput"),Je=be()({name:"VFileInput",inheritAttrs:!1,props:Ue(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,c){let{attrs:d,emit:i,slots:l}=c;const{t:n}=ye(),s=ge(e,"modelValue"),{isFocused:V,focus:A,blur:P}=he(e),u=h(()=>typeof e.showSize!="boolean"?e.showSize:void 0),o=h(()=>{var t;return((t=s.value)!=null?t:[]).reduce((p,m)=>{let{size:k=0}=m;return p+k},0)}),f=h(()=>H(o.value,u.value)),R=h(()=>{var t;return((t=s.value)!=null?t:[]).map(p=>{const{name:m="",size:k=0}=p;return e.showSize?`${m} (${H(k,u.value)})`:m})}),ee=h(()=>{var p,m;const t=(m=(p=s.value)==null?void 0:p.length)!=null?m:0;return e.showSize?n(e.counterSizeString,t,f.value):n(e.counterString,t)}),J=y(),O=y(),g=y(),te=h(()=>V.value||e.active),j=h(()=>["plain","underlined"].includes(e.variant));function z(){var t;g.value!==document.activeElement&&((t=g.value)==null||t.focus()),V.value||A()}function ae(t){E(t)}function le(t){i("mousedown:control",t)}function E(t){var p;(p=g.value)==null||p.click(),i("click:control",t)}function ne(t){t.stopPropagation(),z(),_e(()=>{s.value=[],$e(e["onClick:clear"],t)})}return Ve(s,t=>{(!Array.isArray(t)||!t.length)&&g.value&&(g.value.value="")}),Ce(()=>{const t=!!(l.counter||e.counter),p=!!(t||l.details),[m,k]=ke(d),[{modelValue:Ee,...oe}]=L.filterProps(e),[se]=we(e);return a(L,_({ref:J,modelValue:s.value,"onUpdate:modelValue":w=>s.value=w,class:["v-file-input",{"v-text-field--plain-underlined":j.value},e.class],style:e.style,"onClick:prepend":ae},m,oe,{centerAffix:!j.value,focused:V.value}),{...l,default:w=>{let{id:I,isDisabled:x,isDirty:M,isReadonly:T,isValid:re}=w;return a(xe,_({ref:O,"prepend-icon":e.prependIcon,onMousedown:le,onClick:E,"onClick:clear":ne,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},se,{id:I.value,active:te.value||M.value,dirty:M.value,disabled:x.value,focused:V.value,error:re.value===!1}),{...l,default:ie=>{var Y;let{props:{class:ue,...de}}=ie;return a(B,null,[a("input",_({ref:g,type:"file",readonly:T.value,disabled:x.value,multiple:e.multiple,name:e.name,onClick:b=>{b.stopPropagation(),T.value&&b.preventDefault(),z()},onChange:b=>{var q;if(!b.target)return;const ce=b.target;s.value=[...(q=ce.files)!=null?q:[]]},onFocus:z,onBlur:P},de,k),null),a("div",{class:ue},[!!((Y=s.value)!=null&&Y.length)&&(l.selection?l.selection({fileNames:R.value,totalBytes:o.value,totalBytesReadable:f.value}):e.chips?R.value.map(b=>a(ze,{key:b,size:"small",color:e.color},{default:()=>[b]})):R.value.join(", "))])])}})},details:p?w=>{var I,x;return a(B,null,[(I=l.details)==null?void 0:I.call(l,w),t&&a(B,null,[a("span",null,null),a(Se,{active:!!((x=s.value)!=null&&x.length),value:ee.value},l.counter)])])}:void 0})}),Ie({},J,O,g)}}),Oe={__name:"import",setup(e){const c=Fe(),d=y(!1),i=y([]),l=y({visible:!1}),n=y({}),s=y(!1);async function V(){if(i.value.length!=1){n.value={};return}try{if(n.value=JSON.parse(await i.value[0].text()),!n.value.encryption||!n.value.stores){l.value={visible:!0,type:"error",title:"Unsuitable data file",text:"The provided data file is missing critical information"};return}n.value.encryption.enabled&&(d.value=!0,s.value=!0)}catch{l.value={visible:!0,type:"error",title:"Unsuitable data file",text:"The provided data file does not contain valid JSON"}}}async function A(){await Z.purge();for(let u in D)for(let o in n.value.stores[u])await c.add(u,JSON.parse(JSON.stringify(n.value.stores[u][o])),Number(o));i.value=[],n.value={},l.value={visible:!0,type:"success",title:"Import successful",text:"You can now access and edit your imported data on this device"}}function P(u){s.value=!1;for(let o in n.value.stores)for(let f in n.value.stores[o])n.value.stores[o][f]=JSON.parse(K.AES.decrypt(n.value.stores[o][f],u).toString(K.enc.Utf8));d.value=!1}return(u,o)=>($(),F(X,{"prepend-icon":"mdi-arrow-down-bold"},{title:r(()=>[S(v(u.$t("settings.export.import.title")),1)]),default:r(()=>[a(Q,null,{default:r(()=>[C("p",null,v(u.$t("settings.export.import.p1")),1),a(U,null,{default:r(()=>[a(N,{cols:"12"},{default:r(()=>[a(Je,{accept:".json",label:u.$t("settings.export.import.file_label"),modelValue:i.value,"onUpdate:modelValue":[o[0]||(o[0]=f=>i.value=f),V]},null,8,["label","modelValue"])]),_:1})]),_:1}),d.value?($(),F(U,{key:0,onClick:o[1]||(o[1]=f=>s.value=!0),style:{cursor:"pointer"}},{default:r(()=>[a(N,{cols:"12",class:"d-flex align-center justify-center"},{default:r(()=>[a(Ne,{icon:"mdi-lock-open-outline"}),S(" "+v(u.$t("modals.decrypt.title")),1)]),_:1})]),_:1})):Ae("",!0),a(Pe,{onClose:o[2]||(o[2]=f=>s.value=!1),onUnlocked:P,testphrase:n.value.encryption?n.value.encryption.testphrase:"",show:s.value},null,8,["testphrase","show"]),a(Re,_({class:"my-2",variant:"tonal",modelValue:l.value.visible,"onUpdate:modelValue":o[3]||(o[3]=f=>l.value.visible=f)},l.value,{closable:""}),null,16,["modelValue"]),a(W,{color:"primary",block:"","prepend-icon":"mdi-arrow-down",onClick:A,disabled:n.value.stores==null||d.value},{default:r(()=>[S(v(u.$t("settings.export.import.import_action")),1)]),_:1},8,["disabled"])]),_:1})]),_:1}))}},je={class:"text-h2"},He={__name:"export",setup(e){return(c,d)=>($(),F(Be,null,{default:r(()=>[C("h1",je,v(c.$t("settings.export.title")),1),C("p",null,v(c.$t("settings.export.p1")),1),C("p",null,v(c.$t("settings.export.p2")),1),C("p",null,v(c.$t("settings.export.p3")),1),a(U,null,{default:r(()=>[a(N,{cols:"12",md:"6"},{default:r(()=>[a(De)]),_:1}),a(N,{cols:"12",md:"6"},{default:r(()=>[a(Oe)]),_:1})]),_:1})]),_:1}))}};export{He as default};
