import{ay as F,a2 as I,x as V,z as T,a4 as f,a5 as _,c as s,a6 as g,a9 as J,aa as d,aw as O,ar as e,at as $,ab as U,ac as D,E as L,bp as z,ad as h,o as B,aB as S,a7 as N}from"./index.c008f4b7.js";import{_ as A}from"./deleteModal.554ad063.js";import{b as j,c as H,d as K,V as M,a as q}from"./VTable.3082b37a.js";import{V as Q}from"./VForm.94c3fd6c.js";import{V as E}from"./VSelect.764374fb.js";import{V as X}from"./VContainer.0e6f66d5.js";import{b as Y}from"./VList.33efd938.js";import"./VSelectionControl.b676dcd8.js";import"./VChip.563f6689.js";/* empty css              */import"./ssrBoot.472001c1.js";const Z={class:"d-flex"},ee={__name:"groupForm",props:["edit"],emits:["change"],setup(k,{emit:b}){const c=k,{t:u}=F(),a=I(),i=V({visible:!1}),v=V(null),l=V({}),p={required:o=>o?!0:u("forms.required")},w=V(null),x=V(!1);T(c,(o,m)=>{c.edit!==null?(l.value=JSON.parse(JSON.stringify(a.pillGroups[c.edit])),l.value.id=c.edit,v.value=0):l.value={}});async function G(){if(await w.value.validate(),!!x.value)try{let o=JSON.parse(JSON.stringify(l.value));if(o.id){let m=Number(o.id);delete o.id,await a.update("pillGroups",m,o),b("change"),i.value={visible:!0,type:"success",title:u("settings.pills.changes_saved_title"),text:u("settings.pills.changes_saved_title")}}else await a.add("pillGroups",o),i.value={visible:!0,type:"success",title:u("settings.pills.group_added_title"),text:u("settings.pills.group_added_text")},b("change");l.value={}}catch(o){i.value={visible:!0,type:"error",title:u("settings.pills.save_failed_title"),text:o.message}}}async function C(o){try{await a.remove("pillGroups",o),i.value={visible:!0,type:"success",title:u("settings.pills.group_deleted_title"),text:""},b("change")}catch(m){i.value={visible:!0,type:"error",title:u("settings.pills.save_failed_title"),text:m.message}}}return(o,m)=>(f(),_(h,null,[s(M,{modelValue:v.value,"onUpdate:modelValue":m[3]||(m[3]=y=>v.value=y)},{default:g(()=>[s(j,null,{default:g(()=>[s(H,null,{default:g(()=>[J(d(o.$t("settings.pills.add_edit_group")),1)]),_:1}),s(K,null,{default:g(()=>[s(Q,{ref_key:"form",ref:w,modelValue:x.value,"onUpdate:modelValue":m[2]||(m[2]=y=>x.value=y)},{default:g(()=>[s(O,{modelValue:l.value.name,"onUpdate:modelValue":m[0]||(m[0]=y=>l.value.name=y),label:o.$t("settings.pills.name"),rules:[p.required]},null,8,["modelValue","label","rules"]),e("div",Z,[s($,{color:"blue","prepend-icon":"mdi-content-save",onClick:G,style:{"flex-grow":"3"}},{default:g(()=>[J(d(o.$t("forms.save_action")),1)]),_:1}),l.value.id?(f(),U(A,{key:0,style:{"flex-grow":"1","margin-left":"4px"},onDelete:m[1]||(m[1]=y=>C(Number(l.value.id)))})):D("",!0)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(z,L({modelValue:i.value.visible,"onUpdate:modelValue":m[4]||(m[4]=y=>i.value.visible=y)},i.value,{closable:"",class:"my-2"}),null,16,["modelValue"])],64))}},le=e("th",null,null,-1),te={class:"d-flex mt-2"},ne={__name:"pillForm",props:["edit"],emits:["change"],setup(k,{emit:b}){const c=k,u=I(),{t:a}=F(),i=V({visible:!1}),v=V(null),l=V({contents:[]}),p=V({}),w=B(()=>{let t=[];for(let n in u.pillGroups)t.push({title:u.pillGroups[n].name,value:Number(n)});return t}),x=B(()=>{let t=[];for(let n in u.categories)l.value.contents.some(P=>P.ingredient==n)||t.push({title:u.categories[n].name,value:Number(n)});return t}),G={required:t=>t?!0:a("forms.required")},C=V(null),o=V(!1);T(c,(t,n)=>{c.edit!==null?(l.value=JSON.parse(JSON.stringify(u.pills[c.edit])),l.value.id=c.edit,v.value=0):l.value={contents:[]}});async function m(){if(await C.value.validate(),!!o.value){if(l.value.contents.length==0){i.value={visible:!0,type:"error",title:a("settings.pills.no_ingredients_title"),text:a("settings.pills.no_ingredients_title")};return}try{let t=JSON.parse(JSON.stringify(l.value));if(t.group==null&&delete t.group,t.id){let n=Number(t.id);delete t.id,await u.update("pills",n,t),i.value={visible:!0,type:"success",title:a("settings.pills.changes_saved_title"),text:a("settings.pills.changes_saved_text")},b("change")}else await u.add("pills",t),i.value={visible:!0,type:"success",title:a("settings.pills.pill_added_title"),text:a("settings.pills.pill_added_text")},b("change");l.value={contents:[]}}catch(t){console.error(t),i.value={visible:!0,type:"error",title:a("settings.pills.save_failed_title"),text:t.message}}}}async function y(t){try{await u.remove("pills",t),i.value={visible:!0,type:"success",title:a("settings.pills.pill_deleted_title"),text:a("settings.pills.pill_deleted_text")},b("change")}catch(n){i.value={visible:!0,type:"error",title:a("settings.pills.save_failed_title"),text:n.message}}}function R(t){l.value.contents.splice(l.value.contents.findIndex(n=>n.ingredient==t),1)}function W(){!(p.value.ingredient&&p.value.amount)||(p.value.amount=Number(p.value.amount),l.value.contents.push(JSON.parse(JSON.stringify(p.value))),p.value={})}return(t,n)=>(f(),_(h,null,[s(M,{modelValue:v.value,"onUpdate:modelValue":n[6]||(n[6]=r=>v.value=r)},{default:g(()=>[s(j,null,{default:g(()=>[s(H),s(K,null,{default:g(()=>[s(Q,{ref_key:"form",ref:C,modelValue:o.value,"onUpdate:modelValue":n[5]||(n[5]=r=>o.value=r)},{default:g(()=>[s(O,{modelValue:l.value.name,"onUpdate:modelValue":n[0]||(n[0]=r=>l.value.name=r),label:"name",rules:[G.required]},null,8,["modelValue","rules"]),s(E,{items:w.value,modelValue:l.value.group,"onUpdate:modelValue":n[1]||(n[1]=r=>l.value.group=r),label:t.$t("settings.pills.group"),clearable:""},null,8,["items","modelValue","label"]),s(q,{hover:""},{default:g(()=>[e("thead",null,[e("tr",null,[e("th",null,d(t.$t("settings.pills.ingredient")),1),e("th",null,d(t.$t("settings.pills.amount")),1),le])]),e("tbody",null,[(f(!0),_(h,null,S(l.value.contents,r=>(f(),_("tr",{key:"new-"+r.ingredient},[e("td",null,d(N(u).categories[r.ingredient].name),1),e("td",null,d(r.amount)+" mg",1),e("td",null,[s($,{color:"error",variant:"plain",icon:"mdi-close",onClick:P=>R(r.ingredient)},null,8,["onClick"])])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",null,[s(E,{label:t.$t("settings.pills.ingredient"),modelValue:p.value.ingredient,"onUpdate:modelValue":n[2]||(n[2]=r=>p.value.ingredient=r),items:x.value,"hide-details":"",density:"compact"},null,8,["label","modelValue","items"])]),e("td",null,[s(O,{label:t.$t("settings.pills.amount")+" (mg)",type:"number",min:"0",modelValue:p.value.amount,"onUpdate:modelValue":n[3]||(n[3]=r=>p.value.amount=r),"hide-details":"",density:"compact"},null,8,["label","modelValue"])]),e("td",null,[s($,{color:"success",variant:"plain",icon:"mdi-plus",onClick:W})])])])]),_:1}),e("div",te,[s($,{color:"blue","prepend-icon":"mdi-content-save",onClick:m,style:{"flex-grow":"3"}},{default:g(()=>[J(d(t.$t("forms.save_action")),1)]),_:1}),l.value.id?(f(),U(A,{key:0,style:{"flex-grow":"1","margin-left":"4px"},onDelete:n[4]||(n[4]=r=>y(Number(l.value.id)))})):D("",!0)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(z,L({modelValue:i.value.visible,"onUpdate:modelValue":n[7]||(n[7]=r=>i.value.visible=r)},i.value,{closable:"",class:"my-2"}),null,16,["modelValue"])],64))}},se={class:"text-h2"},ae={class:"text-h3"},ie=e("th",null,null,-1),ue={class:"text-h3"},oe=e("th",null,null,-1),_e={__name:"pills",setup(k){const b=I(),c=V(null),u=V(null);return(a,i)=>(f(),U(X,null,{default:g(()=>[e("h1",se,d(a.$t("settings.pills.title")),1),e("p",null,d(a.$t("settings.pills.p1")),1),e("p",null,d(a.$t("settings.pills.p2")),1),e("p",null,d(a.$t("settings.pills.p3")),1),e("h2",ae,d(a.$t("settings.pills.groups")),1),s(ee,{edit:c.value,onChange:i[0]||(i[0]=v=>c.value=null)},null,8,["edit"]),s(q,{hover:""},{default:g(()=>[e("thead",null,[e("tr",null,[e("th",null,d(a.$t("settings.pills.name")),1),ie])]),e("tbody",null,[(f(!0),_(h,null,S(N(b).pillGroups,(v,l)=>(f(),_("tr",{key:l},[e("td",null,d(v.name),1),e("td",null,[s($,{color:"blue",variant:"plain",icon:"mdi-square-edit-outline",onClick:p=>c.value=l},null,8,["onClick"])])]))),128))])]),_:1}),e("h2",ue,d(a.$t("settings.pills.pills")),1),s(ne,{edit:u.value,onChange:i[1]||(i[1]=v=>u.value=null)},null,8,["edit"]),s(q,{hover:""},{default:g(()=>[e("thead",null,[e("tr",null,[e("th",null,d(a.$t("settings.pills.name")),1),e("th",null,d(a.$t("settings.pills.group")),1),e("th",null,d(a.$t("settings.pills.ingredients")),1),oe])]),e("tbody",null,[(f(!0),_(h,null,S(N(b).pills,(v,l)=>(f(),_("tr",{key:l},[e("td",null,d(v.name),1),e("td",null,d(v.group?N(b).pillGroups[v.group].name:""),1),e("td",null,[(f(!0),_(h,null,S(v.contents,p=>(f(),U(Y,{key:l+"-"+p.ingredient,title:N(b).categories[p.ingredient].name,subtitle:p.amount+" mg"},null,8,["title","subtitle"]))),128))]),e("td",null,[s($,{color:"blue",variant:"plain",icon:"mdi-square-edit-outline",onClick:p=>u.value=Number(l)},null,8,["onClick"])])]))),128))])]),_:1})]),_:1}))}};export{_e as default};
